# 什么是 AOP

AOP 为 Aspect Oriented Programming 的缩写，意为：面向切面编程。作为面向对象的一种补充，将公共逻辑（事务管理、日志、缓存等）封装成切面，跟业务代码进行分离，可以减少系统的重复代码和降低模块之间的耦合度，提高程序的可重用性，同时提高了开发的效率。切面就是那些与业务无关，但所有业务模块都会调用的公共逻辑。

# AOP 有哪些实现方式

AOP有两种实现方式：静态代理和动态代理。

**静态代理**

静态代理：代理类在编译阶段生成，在编译阶段将通知织入 Java 字节码中，也称编译时增强。AspectJ 使用的是静态代理。

缺点：代理对象需要与目标对象实现一样的接口，并且实现接口的方法，会有冗余代码。同时，一旦接口增加方法，目标对象与代理对象都要维护。

**动态代理**

动态代理：代理类在程序运行时创建，AOP 框架不会去修改字节码，而是在内存中临时生成一个代理对象，在运行期间对业务方法进行增强，不会生成新类。

# Spring AOP 的实现原理

Spring AOP 是通过动态代理实现的。如果我们为 Spring 的某个 bean 配置了切面，那么 Spring 在创建这个 bean 的时候，实际上创建的是这个 bean 的一个代理对象，我们后续对 bean 中方法的调用，实际上调用的是代理类重写的代理方法。而 Spring 的 AOP 使用了两种动态代理，分别是 JDK 的动态代理，以及 CGLib 的动态代理。

**JDK 动态代理**

如果目标类实现了接口，Spring AOP 会选择使用 JDK 动态代理目标类。代理类根据目标类实现的接口动态生成，不需要自己编写，生成的动态代理类和目标类都实现相同的接口。JDK 动态代理的核心是 InvocationHandler 接口和 Proxy 类。

缺点：目标类必须有实现的接口。如果某个类没有实现接口，那么这个类就不能用JDK动态代理。

**CGLIB 动态代理**

通过继承实现。如果目标类没有实现接口，那么 Spring AOP 会选择使用 CGLIB 来动态代理目标类。CGLIB（Code Generation Library）可以在运行时动态生成类的字节码，动态创建目标类的子类对象，在子类对象中增强目标类。CGLIB 是通过继承的方式做的动态代理，因此如果某个类被标记为 final，那么它是无法使用 CGLIB 做动态代理的。

优点：目标类不需要实现特定的接口，更加灵活。

**JDK 动态代理和 CGLIB 动态代理的区别**

实现区别：
+ JDK 动态代理使用 JDK 中的类 Proxy 来创建代理对象，它使用反射技术来实现，不需要导入其他依赖
+ CGLIB 需要引入相关依赖：asm.jar，它使用字节码增强技术来实现

使用区别：
+ 如果目标对象实现了接口，默认情况下会采用 JDK 的动态代理实现
+ 如果目标对象实现了接口，可以强制使用 CGLIB 实现
+ 如果目标对象没有实现了接口，必须采用 CGLIB 库

# Spring AOP 相关术语

+ 切面（Aspect）：切面是通知和切点的结合。通知和切点共同定义了切面的全部内容
+ 连接点（Join point）：指方法，在 Spring AOP 中，一个连接点总是代表一个方法的执行。连接点是在应用执行过程中能够插入切面的一个点。这个点可以是调用方法时、抛出异常时、甚至修改一个字段时。切面代码可以利用这些点插入到应用的正常流程之中，并添加新的行为
+ 通知（Advice）：在 AOP 术语中，切面的工作被称为通知
+ 切入点（Pointcut）：切点的定义会匹配通知所要织入的一个或多个连接点。我们通常使用明确的类和方法名称，或是利用正则表达式定义所匹配的类和方法名称来指定这些切点
+ 引入（Introduction）：引入允许我们向现有类添加新方法或属性
+ 目标对象（Target Object）： 被一个或者多个切面（aspect）所通知（advise）的对象。它通常是一个代理对象
+ 织入（Weaving）：织入是把切面应用到目标对象并创建新的代理对象的过程。在目标对象的生命周期里有以下时间点可以进行织入：
  + 编译期：切面在目标类编译时被织入。AspectJ 的织入编译器是以这种方式织入切面的
  + 类加载期：切面在目标类加载到 JVM 时被织入。需要特殊的类加载器，它可以在目标类被引入应用之前增强该目标类的字节码。AspectJ5的加载时织入就支持以这种方式织入切面
  + 运行期：切面在应用运行的某个时刻被织入。一般情况下，在织入切面时，AOP容器会为目标对象动态地创建一个代理对象。SpringAOP就是以这种方式织入切面

------
摘自：
+ [Spring知识点梳理](http://space.eyescode.top/blog/details/263)
+ [什么是 AOP](https://www.topjavaer.cn/framework/spring.html)